# This file is for use during development, so the entire project is discovered
# by the developer's IDE of choice
cmake_minimum_required(VERSION 3.11)

project(tser_all CXX)

# Test subproject should be added first, because it removes the warning guard
add_subdirectory("${PROJECT_SOURCE_DIR}/../test" "${PROJECT_BINARY_DIR}/test")

add_subdirectory("${PROJECT_SOURCE_DIR}/../example" "${PROJECT_BINARY_DIR}/example")

# Interface libraries can't provide sources until CMake 3.19, so a separate
# target must be used from the development lists file for IDE discovery
set(tser_headers
        "${tser_SOURCE_DIR}/include/tser/base64_encoding.hpp"
        "${tser_SOURCE_DIR}/include/tser/varint_encoding.hpp"
        "${tser_SOURCE_DIR}/include/tser/tser.hpp")

file(WRITE "${PROJECT_BINARY_DIR}/tser_sources.generated.cpp" "\
// Generated by CMake, DO NOT EDIT
")
add_executable(tser_sources EXCLUDE_FROM_ALL
        "${PROJECT_BINARY_DIR}/tser_sources.generated.cpp"
        ${tser_headers})
target_link_libraries(tser_sources PRIVATE KonanM::tser)
